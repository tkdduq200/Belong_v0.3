{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

    <h2>ğŸ“Š 1ì¸ ê³ ë ¹ê°€êµ¬ ê³ ë…ì‚¬ ì¥ê¸° ì˜ˆì¸¡ (2026~2075)</h2>
    <hr>

    <!-- êµ¬ ì„ íƒ í¼ -->
    <form method="POST">
        <label for="gu">ìì¹˜êµ¬ ì„ íƒ:</label>
        <select name="gu" class="form-control" style="max-width: 300px;">
            {% for gu in gu_list %}
                <option value="{{ gu }}" {% if gu == selected_gu %}selected{% endif %}>{{ gu }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary mt-2">ì¡°íšŒ</button>
    </form>

    {% if records %}
    <h4 class="mt-4">{{ selected_gu }} (2026~2075)</h4>

    <!-- í‘œ -->
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>ì—°ë„</th>
                <th>ì˜ˆì¸¡ê°’</th>
                <th>ì˜ˆì¸¡ê°’(ëª…)</th>
            </tr>
        </thead>
        <tbody>
            {% for row in records %}
            <tr>
                <td>{{ row['ì—°ë„'] }}</td>
                <td>{{ row['ì˜ˆì¸¡ê°’']|round(2) }}</td>
                <td>{{ row['ì˜ˆì¸¡ê°’_ëª…'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Chart ìº”ë²„ìŠ¤ -->
    <h4 class="mt-4">ğŸ“ˆ ì—°ë„ë³„ ì˜ˆì¸¡ ì¶”ì„¸ ê·¸ë˜í”„</h4>
    <canvas id="futureChart" width="400" height="200"></canvas>

    <!-- Jinja ë°ì´í„°ë¥¼ JSON-safe ë¸”ë¡ìœ¼ë¡œ ì „ë‹¬ -->
    <script type="application/json" id="future-chart-data">
        {
            "years": [
                {% for row in records %}
                    {{ row['ì—°ë„'] }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            ],
            "values": [
                {% for row in records %}
                    {{ row['ì˜ˆì¸¡ê°’_ëª…'] }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            ]
        }
    </script>

    <!-- Chart.js ì˜ì—­ â€“ VS Code ì˜¤ë¥˜ ì œê±° ìœ„í•´ raw ì ìš© -->
    {% raw %}
    <script>
        const jsonText = document.getElementByI
